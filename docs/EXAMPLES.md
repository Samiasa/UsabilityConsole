# Quick Examples for External Clients

In the endpoints listed in the table below, **`<api_key>`** is intended to be replaced by the specific alphanumeric 
string unique to an individual user account. A user account's API key can be found in their respective settings page. 
Each endpoint can be called programmatically by a invoking simple REST call.

When making a call to a specific endpoint, the protocol, domain, and port are specific to each instance. For example, if
the server application is running on localhost (127.0.0.1) on port 8080, with no SSL configured, the URL of each call
will begin with `http://localhost:8080` or `http://127.0.0.1:8080`. A user with an API key of `qwerty123` who wants to 
initiate a new session would make a call to `http://localhost:8080/ext/qwerty123/new_session`. This call would return 
a unique value for the created session. This unique value, `session_id`, shall be used for all additional web calls.

Examples in this document assume the server application is running on `localhost` on port 8080 with not SSL; the 
assumed API key is `qwerty123`. These values will need to be changed when calling a specific instance of the 
application.  

| Endpoint | Method | Description |
|:---:|:---:|:---|
|[`/ext/<api_key>/new_session`](#trigger-the-start-of-a-new-session)| POST | Forces the console to establish a new session |
|[`/ext/<api_key>/<session_id>`](#post-events-to-the-current-session)| POST | Post event(s) to the current session |
|`/ext/<api_key>/<session_id>/alerts`| GET | Gets all alerts as a list |

## Trigger the start of a new session
| Parameter | Value |
|:---:|:---|
| **URL** | `/ext/<api_key>/new_session` |
| **HTTP Method** | POST |
| **Request Body** | *None* |
| **Response Body** | The ID of the created session |

Example call to initiate a new session:  
`http://localhost:8080/ext/qwerty123/new_session`

## Post events to the current session
| Parameter | Value |
|:---:|:---|
| **URL** | `/ext/<api_key>/<session_id>` |
| **HTTP Method** | POST |
| **Request Body Content-type** | `text/plain` or `application/json` |
| **Request Body Charset** | `UTF-8` |
| **Request Body** | Details of the event(s) in JSON formatting (see below) |
| **Response Body** | `OK` or details of the error |

The format of a single message is as follows:
```json
[
  {
    "id": unique_id_for_this_event,
    "timestamp": "YYYYMMddHHmmss",
    "category": "External",
    "message_data": "message data goes here"
  }
]
```

When an external client (such as an AR or VR system or its host machine) is making a call to the usability console, the 
`category` field *shall* always be `External`. 

The value for the `id` field is not required, but is recommended. The value of this field, if present, must be a positive integer value; this can be a pseudo-random number generated by the client. This field is used to make sure the evenst do not get duplicated in the database.

The value of the `timestamp` field is not required. If no value is provided, the server application will calculate the
current time upon receiving the event posting. If a value is provided, it must be in `YYYYMMddHHmmss` format. This is
useful when the AR/VR system collects multiple messages before sending them to the server application, thus preventing
multiple calls in quick succession.

The `message_data` field is intended to relay any relevant information for the specific event. Its format *should* be
mutually agreed upon by the client and server developer(s).

Example request bodies can be found below. Note: the outer square brackets are required whether submitting one or
multiple events.

##### Example request body posting a single event:
```json
[
  {
    "id": 1,
    "timestamp": "20190829121900",
    "category": "External",
    "message_data": "BUTTON TRIGGER"
  }
]
```
##### Example request body posting 4 events:
```json
[
  {
    "id": 1,
    "timestamp": "20190829121900",
    "category": "External",
    "message_data": "BUTTON TRIGGER"
  }, {
    "id": 2,
    "timestamp": "20190829121930",
    "category": "External",
    "message_data": "TELEPORT (13.5, 43.1) TO (18.2, 50.0)"
  }, {
    "id": 3,
    "timestamp": "20190829121945",
    "category": "External",
    "message_data": "TELEPORT (18.2, 50.0) TO (15.8, 55.7)"
  }, {
    "id": 5,
    "timestamp": "20190829122955",
    "category": "External",
    "message_data": "GESTURE GRAB fire_extinguisher_1"
  }
]
```

## Retrieve all alerts for the current session
| Parameter | Value |
|:---:|:---|
| **URL** | `/ext/<api_key>/<session_id>/alerts` |
| **HTTP Method** | GET |
| **Request Body** | *None* |
| **Response Body** | `OK` or details of the error |

Example call to initiate a new session:  
`http://localhost:8080/ext/qwerty123/12345/alerts`



##### Example response body with a single alert:
```json
[
  {
    "value": "Restart Office Fire", 
    "time_created": "2020-05-06 18:46:26"
  }
]
```
##### Example response body with multiple events:
```json
[
  {
    "value": "Disable Sprinklers", 
    "time_created": "2020-05-06 18:47:46"
  }, {
    "value": "Disable Fire Alarm", 
    "time_created": "2020-05-06 18:47:47"
  }, {
    "value": "Restart Office Fire", 
    "time_created": "2020-05-06 18:47:48"
  }
]
```